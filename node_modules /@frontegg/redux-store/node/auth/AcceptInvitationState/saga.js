"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.acceptInvitationSagas = acceptInvitationSagas;
var _effects = require("redux-saga/effects");
var _reducer = require("../reducer");
var _restApi = require("@frontegg/rest-api");
var _interfaces = require("./interfaces");
var _utils = require("../../utils");
function* acceptInvitation({
  payload
}) {
  if (!payload.token || !payload.userId) {
    yield (0, _effects.put)(_reducer.actions.setAcceptInvitationState({
      error: undefined,
      step: _interfaces.AcceptInvitationStep.invalid
    }));
    return;
  }
  try {
    yield (0, _effects.put)(_reducer.actions.setAcceptInvitationState({
      error: undefined,
      step: _interfaces.AcceptInvitationStep.pending
    }));
    yield (0, _effects.call)(_restApi.api.auth.acceptInvitation, payload);
    yield (0, _effects.put)(_reducer.actions.setState({
      isAuthenticated: false,
      user: null,
      acceptInvitationState: {
        error: undefined,
        step: _interfaces.AcceptInvitationStep.success
      }
    }));
  } catch (e) {
    yield (0, _effects.put)(_reducer.actions.setAcceptInvitationState({
      step: _interfaces.AcceptInvitationStep.failed,
      error: (0, _utils.errorHandler)(e)
    }));
  }
}
function* acceptInvitationSagas() {
  yield (0, _effects.takeLeading)(_reducer.actions.acceptInvitation, acceptInvitation);
}