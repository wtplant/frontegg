"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.impersonateSagas = impersonateSagas;
var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));
var _restApi = require("@frontegg/rest-api");
var _effects = require("redux-saga/effects");
var _saga = require("../LoginState/saga");
var _reducer = require("../reducer");
var _interfaces = require("./interfaces");
var _utils = require("../../utils");
const _excluded = ["callback", "events"];
function* impersonate(_ref) {
  let {
      payload: {
        callback
      }
    } = _ref,
    payload = (0, _objectWithoutPropertiesLoose2.default)(_ref.payload, _excluded);
  yield (0, _effects.put)(_reducer.actions.setImpersonateState({
    loading: true
  }));
  try {
    const data = yield (0, _effects.call)(_restApi.api.impersonate.impersonate, payload);
    yield (0, _effects.put)(_reducer.actions.setImpersonateState({
      step: _interfaces.ImpersonateStep.success
    }));
    yield (0, _effects.delay)(1000);
    yield (0, _saga.afterAuthNavigation)();
    yield (0, _effects.put)(_reducer.actions.resetImpersonateState());
    callback == null ? void 0 : callback(true);
  } catch (e) {
    yield (0, _effects.put)(_reducer.actions.setImpersonateState({
      loading: false,
      error: (0, _utils.errorHandler)(e)
    }));
  }
}
function* impersonateSagas() {
  yield (0, _effects.takeLeading)(_reducer.actions.impersonate, impersonate);
}