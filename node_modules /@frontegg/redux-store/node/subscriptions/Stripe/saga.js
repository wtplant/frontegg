"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.subscriptionStripeSagas = subscriptionStripeSagas;
var _effects = require("redux-saga/effects");
var _index = require("./index");
var _restApi = require("@frontegg/rest-api");
var _utils = require("../../utils");
function* subscriptionStripeSagas() {
  yield (0, _effects.takeEvery)(_index.stripeActions.createCardSetupIntentSecret, createCardSetupIntentSecret);
}
function* createCardSetupIntentSecret({
  payload
}) {
  yield (0, _effects.put)(_index.stripeActions.setState({
    loading: true,
    error: null,
    cardSetupIntentSecret: null
  }));
  try {
    const request = {};
    if (payload) {
      request.paymentMethodId = payload;
    }
    const {
      setupIntentSecret
    } = yield (0, _effects.call)(_restApi.api.subscriptions.createStripePaymentMethodSetupIntentSecret, request);
    yield (0, _effects.put)(_index.stripeActions.setState({
      cardSetupIntentSecret: setupIntentSecret,
      loading: false
    }));
  } catch (e) {
    yield (0, _effects.put)(_index.stripeActions.setError((0, _utils.errorHandler)(e)));
  }
}